<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用webpack搭建React项目开发环境 | QuiErro&#39;s blog</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.3.0">
    
    
    <link rel="preload" href="/assets/css/0.styles.93dcc6b2.css" as="style"><link rel="preload" href="/assets/js/app.2619889f.js" as="script"><link rel="preload" href="/assets/js/2.96a76ef5.js" as="script"><link rel="preload" href="/assets/js/16.f4417e8a.js" as="script"><link rel="prefetch" href="/assets/js/10.5bda610d.js"><link rel="prefetch" href="/assets/js/11.aaafe754.js"><link rel="prefetch" href="/assets/js/12.c8c4a9dc.js"><link rel="prefetch" href="/assets/js/13.bb83ed70.js"><link rel="prefetch" href="/assets/js/14.7d6fc175.js"><link rel="prefetch" href="/assets/js/15.8ff5a488.js"><link rel="prefetch" href="/assets/js/17.23a97fb3.js"><link rel="prefetch" href="/assets/js/18.8a0fa7a6.js"><link rel="prefetch" href="/assets/js/19.1ae67b9a.js"><link rel="prefetch" href="/assets/js/3.def7da81.js"><link rel="prefetch" href="/assets/js/4.ad57049c.js"><link rel="prefetch" href="/assets/js/5.50374dc2.js"><link rel="prefetch" href="/assets/js/6.be928897.js"><link rel="prefetch" href="/assets/js/7.eb8c7482.js"><link rel="prefetch" href="/assets/js/8.a0ec3913.js"><link rel="prefetch" href="/assets/js/9.ffa921f0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.93dcc6b2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">QuiErro's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/frontend/summary-antdpro.html" class="nav-link">
  Frontend
</a></div><div class="nav-item"><a href="/frontend/frontend-algorithm.html" class="nav-link">
  前端算法
</a></div><div class="nav-item"><a href="/laravel/laradock.html" class="nav-link">
  Laravel
</a></div> <a href="https://github.com/QuiErro/QuiErro.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    My GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/frontend/summary-antdpro.html" class="nav-link">
  Frontend
</a></div><div class="nav-item"><a href="/frontend/frontend-algorithm.html" class="nav-link">
  前端算法
</a></div><div class="nav-item"><a href="/laravel/laradock.html" class="nav-link">
  Laravel
</a></div> <a href="https://github.com/QuiErro/QuiErro.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    My GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend/summary-antdpro.html" class="sidebar-link">antd pro 使用小结</a></li><li><a href="/frontend/antdpro-authority-management.html" class="sidebar-link">antd pro 权限管理</a></li><li><a href="/frontend/frontend-algorithm.html" class="sidebar-link">前端算法</a></li><li><a href="/frontend/webpack-setting.html" class="sidebar-link">Webpack基本配置</a></li><li><a href="/frontend/learning-nuxt.html" class="sidebar-link">Nuxt.js学习笔记</a></li><li><a href="/frontend/learning-next.html" class="sidebar-link">Next.js学习笔记</a></li><li><a href="/frontend/webpack-react.html" class="active sidebar-link">使用webpack搭建React项目开发环境</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/webpack-react.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/frontend/webpack-react.html#webpack基本配置" class="sidebar-link">webpack基本配置</a></li><li class="sidebar-sub-header"><a href="/frontend/webpack-react.html#结尾" class="sidebar-link">结尾</a></li></ul></li><li><a href="/frontend/dva-shopping-cart.html" class="sidebar-link">初探dva——购物车实战</a></li><li><a href="/frontend/source-code.html" class="sidebar-link">试着实现JS源码</a></li><li><a href="/frontend/prototype.html" class="sidebar-link">谈谈JS中的继承与原型链</a></li><li><a href="/frontend/colorful-balls.html" class="sidebar-link">炫彩小球：基于Canvas和ES6中的Class类知识点的练习</a></li><li><a href="/frontend/web-shop.html" class="sidebar-link">用Vue+Node搭建网上购物商城</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="使用webpack搭建react项目开发环境"><a href="#使用webpack搭建react项目开发环境" class="header-anchor">#</a> 使用webpack搭建React项目开发环境</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>在日常开发中，我们通常会选择脚手架<code>vue-cli</code>、<code>create-react-app</code>等来帮助开发。可是了解并掌握<code>webpack</code>来完成项目工程化开发却是一门基本功</p> <p>本文基于：<br> <code>webpack: 4.41.2</code><br> <code>node: 10.15.1</code><br> <code>yarn: 1.16.0</code></p> <h2 id="webpack基本配置"><a href="#webpack基本配置" class="header-anchor">#</a> webpack基本配置</h2> <h3 id="_1-1-初始化react项目"><a href="#_1-1-初始化react项目" class="header-anchor">#</a> 1.1 初始化React项目</h3> <ul><li>在新建目录下<br> <code>yarn init</code></li> <li>安装React相关包<br> <code>yarn add react react-dom axios</code></li> <li>安装babel<br>
在开发中，我们经常使用ES6+的语法，但是并非所有浏览器都有将ES6+语法转换成javascript的能力，所以这就是我们为何使用babel的原因，babel能将ES6+的语法转换为兼容的JS语法
<ul><li><p>安装<code>babel</code>的核心包和命令行工具<br> <code>yarn add @babel/core</code><br> <code>yarn add @babel/cli</code></p></li> <li><p>安装<code>babel</code>的预置配置和语法插件<br> <code>yarn add @babel/preset-env</code> 支持ES6语法<br> <code>yarn add @babel/preset-react</code> 支持React语法<br> <code>yarn add @babel/plugin-proposal-class-properties</code>  支持类属性</p></li> <li><p>编辑<code>.babelrc</code>  使安装的插件和配置生效</p> <div class="language-javacript extra-class"><pre class="language-text"><code>{
    &quot;presets&quot;: [
        [
            &quot;@babel/preset-env&quot;,
            {
                &quot;useBuiltIns&quot;: &quot;entry&quot;,
                &quot;corejs&quot;: 3
            }
        ],
        &quot;@babel/preset-react&quot;
    ],
    &quot;plugins&quot;: [
        &quot;@babel/plugin-proposal-class-properties&quot;
    ]
}
</code></pre></div></li> <li><p>安装<code>babel-polyfill</code></p> <ul><li>babel默认只转换语法，但不转换对象。可开发时由于原浏览器没有例如Promise、Symbol这些对象的语法，我们需要使用时，就得对babel的配置做些调整</li> <li>我们可以使用<code>babel-polyfill</code>来解决这一问题。其原理是自己实现了ES6+的所有对象和实例方法，但缺点是污染了全局空间和内置对象，可能会出现同名对象冲突</li></ul> <p><code>yarn add @babel/polyfill</code></p></li></ul></li></ul> <h3 id="_1-2-使用webpack"><a href="#_1-2-使用webpack" class="header-anchor">#</a> 1.2 使用webpack</h3> <ul><li><p>安装
<code>yarn add webpack webpack-cli</code></p></li> <li><p>新建<code>src/index.js</code> 作为全局入口</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token string">&quot;@babel/polyfill&quot;</span>  <span class="token comment">// 放在开头</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>
</code></pre></div></li> <li><p>创建<code>webpack.config.js</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>  <span class="token comment">// 入口文件</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token comment">// 出口文件(编译后)</span>
        filename<span class="token operator">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// babel-loader将根据.babelrc去处理文件</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p><code>yarn add babel-loader</code></p></li></ul> <h3 id="_1-3-集成webapck-dev-server"><a href="#_1-3-集成webapck-dev-server" class="header-anchor">#</a> 1.3 集成webapck-dev-server</h3> <ul><li><p><code>yarn add webapck-dev-server</code> 快速搭建本地运行环境</p></li> <li><p><code>yarn add html-webpack-plugin</code>在内存中生成html</p></li> <li><p>修改<code>package.json</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-dev-server --open --port 8081 --contentBase src --hot&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --mode production&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div></li> <li><p>修改<code>webpack.config.js</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> htmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        filename<span class="token operator">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">htmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            template<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./index.html'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            filename<span class="token operator">:</span> <span class="token string">'index.html'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>在集成webpack-dev-server、http-webpack-plugin后，访问localhost:8081(在内存中的html页面)对于在html中引入css、图片、less、字体等文件会报错，需要另外处理</p> <ul><li><p><code>yarn add less less-loader css-loader style-loader file-loader</code></p></li> <li><p>修改<code>webpack.config.js</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>rules<span class="token operator">:</span> <span class="token punctuation">[</span>
   <span class="token punctuation">{</span>test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> 
   <span class="token punctuation">{</span>test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span>test<span class="token operator">:</span> <span class="token regex">/\.less$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'less-loader'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span>test<span class="token operator">:</span> <span class="token regex">/\.(eot|svg|ttf|woff|woff2|png)\w*/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div></li> <li><p>修改index.html</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;bundle.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div></li></ul></li></ul> <h3 id="_1-4-配置react路由"><a href="#_1-4-配置react路由" class="header-anchor">#</a> 1.4 配置React路由</h3> <ul><li><code>yarn add react-router react-router-dom</code></li> <li>在配置了<code>react-router</code>后，无法通过输入地址或刷新子路由访问页面<br>
原因： 我们通过react-router配置的只是前端路由，但webpack不会识别前端路由，在服务端匹配不到路径后，会将其自动转到404界面<br>
解决：在<code>webpack.config.js</code>中配置：<div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// webpack在匹配不到对应路径后，会默认返回首页</span>
<span class="token comment">// 这时将由前端路由控制</span>
devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    historyApiFallback<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="_1-5-区分开发环境和生产环境"><a href="#_1-5-区分开发环境和生产环境" class="header-anchor">#</a> 1.5 区分开发环境和生产环境</h3> <ul><li>在<code>webpack.config.js</code>中对开发模式和生产模式做区分：<div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> argv</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 1. 通过 argv 判断是开发还是生产环境</span>
    <span class="token keyword">const</span> isEnvDevelopment <span class="token operator">=</span> argv<span class="token punctuation">.</span>mode <span class="token operator">===</span> <span class="token string">'development'</span> <span class="token operator">||</span> <span class="token operator">!</span>argv<span class="token punctuation">.</span>mode<span class="token punctuation">;</span>
    <span class="token keyword">const</span> isEnvProduction <span class="token operator">=</span> argv<span class="token punctuation">.</span>mode <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">;</span> 
    
    <span class="token keyword">return</span><span class="token punctuation">{</span>
        <span class="token comment">// 2. mode和devtool根据环境做不同配置</span>
        mode<span class="token operator">:</span> isEnvProduction <span class="token operator">?</span> <span class="token string">'production'</span> <span class="token operator">:</span> isEnvDevelopment <span class="token operator">&amp;&amp;</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
        devtool<span class="token operator">:</span> isEnvProduction <span class="token operator">?</span> <span class="token string">'source-map'</span> <span class="token operator">:</span> isEnvDevelopment <span class="token operator">&amp;&amp;</span> <span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span>
        entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
        output<span class="token operator">:</span> <span class="token punctuation">{</span>
            filename<span class="token operator">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>
            path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        module<span class="token operator">:</span> <span class="token punctuation">{</span>
            rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
                exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token string">'babel-loader'</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="_1-6-开发配置"><a href="#_1-6-开发配置" class="header-anchor">#</a> 1.6 开发配置</h3> <ul><li><p><code>Source Map</code>：将目标代码映射到原始代码<br>
经过打包器后，浏览器执行的是目标代码。而在开发中，出错时希望报的错能直接定位到原始代码中，而不是显示目标代码，这时我们需要配置 <code>source map</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> htmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">env<span class="token punctuation">,</span> argv</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> isEnvDevelopment <span class="token operator">=</span> argv<span class="token punctuation">.</span>mode <span class="token operator">===</span> <span class="token string">'development'</span> <span class="token operator">||</span> <span class="token operator">!</span>argv<span class="token punctuation">.</span>mode<span class="token punctuation">;</span>
    <span class="token keyword">const</span> isEnvProduction <span class="token operator">=</span> argv<span class="token punctuation">.</span>mode <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">;</span> 
    
    <span class="token keyword">return</span><span class="token punctuation">{</span>
        mode<span class="token operator">:</span> isEnvProduction <span class="token operator">?</span> <span class="token string">'production'</span> <span class="token operator">:</span> isEnvDevelopment <span class="token operator">&amp;&amp;</span> <span class="token string">'development'</span><span class="token punctuation">,</span> 
        devtool<span class="token operator">:</span> isEnvProduction <span class="token operator">?</span> <span class="token string">'source-map'</span> <span class="token operator">:</span> isEnvDevelopment <span class="token operator">&amp;&amp;</span> <span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span>  <span class="token comment">// 修改</span>
        entry<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        output<span class="token operator">:</span> <span class="token punctuation">{</span>
            filename<span class="token operator">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>
            path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token keyword">new</span> <span class="token class-name">htmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                template<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./public/index.html'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                filename<span class="token operator">:</span> <span class="token string">'index.html'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        module<span class="token operator">:</span> <span class="token punctuation">{</span>
            rules<span class="token operator">:</span> <span class="token punctuation">[</span>
               <span class="token punctuation">{</span>test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> 
               <span class="token punctuation">{</span>test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
               <span class="token punctuation">{</span>test<span class="token operator">:</span> <span class="token regex">/\.less$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'less-loader'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
               <span class="token punctuation">{</span>test<span class="token operator">:</span> <span class="token regex">/\.(eot|svg|ttf|woff|woff2|png)\w*/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
            historyApiFallback<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            contentBase<span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span>
            hot<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>Eslint 与 Prettier</p> <ul><li><p>Eslint的作用是检查代码是否符合规范，并进行提示</p></li> <li><p>Prettier一般配合ESlints使用，ESlints能检测出代码是否规范，但不能完全统一代码风格，而Prettier统一了代码风格，但不能检测代码规范</p></li> <li><p><code>yarn add eslint babel-eslint</code></p></li> <li><p><code>yarn add eslint-config-airbnb</code></p></li> <li><p><code>yarn add eslint-plugin-import eslint-plugin-jsx-a11y eslint-plugin-react</code></p></li> <li><p>创建<code>.eslintrc.js</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// parser用于指定解析器，eslint本身无法解析es6语法，需要转换成babel-eslint</span>
    <span class="token string">&quot;parser&quot;</span><span class="token operator">:</span> <span class="token string">&quot;babel-eslint&quot;</span><span class="token punctuation">,</span> 
    <span class="token comment">// extends表示以airbnb为基础规范 </span>
    <span class="token string">&quot;extends&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;airbnb&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
    <span class="token comment">// env告诉eslint，如果碰到browser和es6的对象，不用报undefined</span>
    <span class="token string">&quot;env&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>  
        browser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> 
        es6<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> 
     <span class="token punctuation">}</span><span class="token punctuation">,</span> 
     <span class="token comment">// rules用于指定扩展规范规则，会覆盖airbnb规则中的配置 </span>
    <span class="token string">&quot;rules&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'react/jsx-filename-extension'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'react/prop-types'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string">'react/prefer-stateless-function'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  
        <span class="token string">'react/no-array-index-key'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 
        <span class="token string">'no-console'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 
        <span class="token string">'jsx-ally/anchor-is-valid'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 
        <span class="token string">'react/destructuring-assignment'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string">'react/jsx-one-expression-per-line'</span><span class="token operator">:</span> <span class="token number">0</span>  
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>手动执行<code>eslint</code> <code>yarn eslint src/</code>  检查src/下的js文件
<code>npx eslint --fix src/</code>  自动修复不规范,只列出那些无法自动修复的</p></li></ul></li> <li><p>配置路径别名<br>
在开发中，我们经常会配置路径别名，快速定位文件，提高效率和文件引入的准确度，通常是用 <code>@</code> 来表示 <code>src</code>目录</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
   alias<span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token string">'@'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>模块化CSS</p> <ul><li>单纯使用<code>style-loader、css-loader</code>，虽然可以在JS中引入CSS样式文件，但随之出现的问题是：
<ul><li>全局污染：<code>CSS</code>文件中的选择器是全局的，不同文件的同名选择器，根据<code>build</code>后生成文件中的先后顺序，后面的样式会覆盖前面的样式</li> <li>选择器复杂，命名规则混乱</li></ul></li> <li>而使用CSS Module模块化处理后，针对每一个JS文件，其引入的CSS文件都只对该文件生效，这有点类似vue中<code>scoped</code>属性起到的作用</li> <li>修改<code>webpack.config.js</code><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader?modules'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div></li> <li>使用示例：
<img src="https://user-gold-cdn.xitu.io/2020/1/2/16f646178367f9ff?w=599&amp;h=287&amp;f=png&amp;s=35649" alt=""></li> <li>CSS Module的原理：对每个类名按照一定规则进行转换(加上hash值)，保证其唯一性，但是只对className和id能进行转换</li></ul></li> <li><p>CSS兼容性处理
使CSS能针对不同浏览器添加不同的前缀，解决浏览器兼容问题</p> <ul><li><p><code>yarn add postcss-loader autoprefixer</code></p></li> <li><p>配置<code>postcss.config.js</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'autoprefixer'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>修改<code>webpack.config.js</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// postcss-loader要放在less-loader前，先从less转为css，再用postcss处理</span>
module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span> exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span> enforce<span class="token operator">:</span> <span class="token string">&quot;pre&quot;</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token punctuation">{</span>test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span> include<span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src/styles'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token regex">/node_modules/</span><span class="token punctuation">]</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span> exclude<span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src/styles'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token regex">/node_modules/</span><span class="token punctuation">]</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader?modules'</span><span class="token punctuation">,</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>test<span class="token operator">:</span> <span class="token regex">/\.less$/</span><span class="token punctuation">,</span> include<span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src/styles'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token regex">/node_modules/</span><span class="token punctuation">]</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">,</span> <span class="token string">'less-loader'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>test<span class="token operator">:</span> <span class="token regex">/\.less$/</span><span class="token punctuation">,</span> exclude<span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src/styles'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token regex">/node_modules/</span><span class="token punctuation">]</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader?modules'</span><span class="token punctuation">,</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">,</span> <span class="token string">'less-loader'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>test<span class="token operator">:</span> <span class="token regex">/\.(eot|svg|ttf|woff|woff2|png)\w*/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>     
        <span class="token punctuation">{</span>
            test<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token regex">/\.bmp$/</span><span class="token punctuation">,</span> <span class="token regex">/\.gif$/</span><span class="token punctuation">,</span> <span class="token regex">/\.jpe?g$/</span><span class="token punctuation">,</span> <span class="token regex">/\.png$/</span><span class="token punctuation">,</span> <span class="token regex">/\.svg$/</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
                limit<span class="token operator">:</span> <span class="token number">10000</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div></li></ul></li></ul> <h3 id="_1-7-生产环境配置"><a href="#_1-7-生产环境配置" class="header-anchor">#</a> 1.7 生产环境配置</h3> <ul><li><p>复制<code>webpack.config.js</code>，重命名为<code>webpack.config.prod.js</code></p></li> <li><p>编辑<code>package.json</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-dev-server --port 8081 --mode development&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config webpack.prod.config.js --mode production&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;watch&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --watch&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div></li> <li><p>修改<code>webpack.prod.js</code>
删除<code>devServer</code>配置</p></li></ul> <h2 id="结尾"><a href="#结尾" class="header-anchor">#</a> 结尾</h2> <p>到此，我们可以使用以下命令：<br> <code>yarn run dev</code> 开发环境下启动项目，在端口8081访问<br> <code>yarn run build</code> 打包编译项目文件，生成dist目录<br>
至于一些webpack的优化配置，如：代码分离、文件体积压缩、配置缓存等以及开发环境中使用HMR模块热更新则不再过多介绍，或者后续将会继续更新</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/frontend/learning-next.html" class="prev">
        Next.js学习笔记
      </a></span> <span class="next"><a href="/frontend/dva-shopping-cart.html">
        初探dva——购物车实战
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2619889f.js" defer></script><script src="/assets/js/2.96a76ef5.js" defer></script><script src="/assets/js/16.f4417e8a.js" defer></script>
  </body>
</html>
