<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>初探dva——购物车实战 | QuiErro&#39;s blog</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.3.0">
    
    
    <link rel="preload" href="/assets/css/0.styles.93dcc6b2.css" as="style"><link rel="preload" href="/assets/js/app.2619889f.js" as="script"><link rel="preload" href="/assets/js/2.96a76ef5.js" as="script"><link rel="preload" href="/assets/js/8.a0ec3913.js" as="script"><link rel="prefetch" href="/assets/js/10.5bda610d.js"><link rel="prefetch" href="/assets/js/11.aaafe754.js"><link rel="prefetch" href="/assets/js/12.c8c4a9dc.js"><link rel="prefetch" href="/assets/js/13.bb83ed70.js"><link rel="prefetch" href="/assets/js/14.7d6fc175.js"><link rel="prefetch" href="/assets/js/15.8ff5a488.js"><link rel="prefetch" href="/assets/js/16.f4417e8a.js"><link rel="prefetch" href="/assets/js/17.23a97fb3.js"><link rel="prefetch" href="/assets/js/18.8a0fa7a6.js"><link rel="prefetch" href="/assets/js/19.1ae67b9a.js"><link rel="prefetch" href="/assets/js/3.def7da81.js"><link rel="prefetch" href="/assets/js/4.ad57049c.js"><link rel="prefetch" href="/assets/js/5.50374dc2.js"><link rel="prefetch" href="/assets/js/6.be928897.js"><link rel="prefetch" href="/assets/js/7.eb8c7482.js"><link rel="prefetch" href="/assets/js/9.ffa921f0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.93dcc6b2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">QuiErro's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/frontend/summary-antdpro.html" class="nav-link">
  Frontend
</a></div><div class="nav-item"><a href="/frontend/frontend-algorithm.html" class="nav-link">
  前端算法
</a></div><div class="nav-item"><a href="/laravel/laradock.html" class="nav-link">
  Laravel
</a></div> <a href="https://github.com/QuiErro/QuiErro.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    My GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/frontend/summary-antdpro.html" class="nav-link">
  Frontend
</a></div><div class="nav-item"><a href="/frontend/frontend-algorithm.html" class="nav-link">
  前端算法
</a></div><div class="nav-item"><a href="/laravel/laradock.html" class="nav-link">
  Laravel
</a></div> <a href="https://github.com/QuiErro/QuiErro.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    My GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend/summary-antdpro.html" class="sidebar-link">antd pro 使用小结</a></li><li><a href="/frontend/antdpro-authority-management.html" class="sidebar-link">antd pro 权限管理</a></li><li><a href="/frontend/frontend-algorithm.html" class="sidebar-link">前端算法</a></li><li><a href="/frontend/webpack-setting.html" class="sidebar-link">Webpack基本配置</a></li><li><a href="/frontend/learning-nuxt.html" class="sidebar-link">Nuxt.js学习笔记</a></li><li><a href="/frontend/learning-next.html" class="sidebar-link">Next.js学习笔记</a></li><li><a href="/frontend/webpack-react.html" class="sidebar-link">使用webpack搭建React项目开发环境</a></li><li><a href="/frontend/dva-shopping-cart.html" class="active sidebar-link">初探dva——购物车实战</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/dva-shopping-cart.html#dva简介" class="sidebar-link">Dva简介</a></li><li class="sidebar-sub-header"><a href="/frontend/dva-shopping-cart.html#购物车实例" class="sidebar-link">购物车实例</a></li><li class="sidebar-sub-header"><a href="/frontend/dva-shopping-cart.html#基本配置" class="sidebar-link">基本配置</a></li><li class="sidebar-sub-header"><a href="/frontend/dva-shopping-cart.html#搭建后台" class="sidebar-link">搭建后台</a></li><li class="sidebar-sub-header"><a href="/frontend/dva-shopping-cart.html#前台开发" class="sidebar-link">前台开发</a></li></ul></li><li><a href="/frontend/source-code.html" class="sidebar-link">试着实现JS源码</a></li><li><a href="/frontend/prototype.html" class="sidebar-link">谈谈JS中的继承与原型链</a></li><li><a href="/frontend/colorful-balls.html" class="sidebar-link">炫彩小球：基于Canvas和ES6中的Class类知识点的练习</a></li><li><a href="/frontend/web-shop.html" class="sidebar-link">用Vue+Node搭建网上购物商城</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="初探dva——购物车实战"><a href="#初探dva——购物车实战" class="header-anchor">#</a> 初探dva——购物车实战</h1> <h2 id="dva简介"><a href="#dva简介" class="header-anchor">#</a> Dva简介</h2> <p>dva 是一个基于 redux 和 redux-saga的数据流方案，并且为了简化开发体验，dva 还额外内置了 react-router 和 fetch，所以也可以理解为dva是一个轻量级的应用框架。   -- 摘自官网</p> <h2 id="购物车实例"><a href="#购物车实例" class="header-anchor">#</a> 购物车实例</h2> <p>本练习使用dva+antd做了个购物车小练习，目的是为了更快上手dva，所以练习的复杂度不高，更多是基础运用开发。<a href="https://github.com/jeffersonRibeiro/react-shopping-cart" target="_blank" rel="noopener noreferrer">项目参考来源<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://quierro.github.io/WuFeng/shopping-cart-dva/" target="_blank" rel="noopener noreferrer">演示网址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://github.com/QuiErro/shopping-cart-dva" target="_blank" rel="noopener noreferrer">github代码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="基本配置"><a href="#基本配置" class="header-anchor">#</a> 基本配置</h2> <ul><li>安装dva脚手架<br> <code>npm install dva-cli -g</code></li> <li>创建新项目<br> <code>dva new shopping-cart-dva</code><br> <code>cd shopping-cart-dva</code></li> <li>在dva项目里使用<code>antd</code> <ul><li><code>yarn add antd babel-plugin-import</code></li> <li>编辑<code>.webpackrc</code>，使<code>babel-plugin-import</code>插件生效<div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;extraBabelPlugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span><span class="token string">&quot;import&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">&quot;libraryName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;antd&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;libraryDirectory&quot;</span><span class="token operator">:</span> <span class="token string">&quot;es&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;style&quot;</span><span class="token operator">:</span> <span class="token string">&quot;css&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li> <li>编辑<code>.webpackrc</code>，配置<code>proxy</code>属性，代理请求<div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token string">&quot;proxy&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;/api&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:3000&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 后端接口</span>
        <span class="token string">&quot;changeOrigin&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// &quot;pathRewrite&quot;: { &quot;^/api&quot; : &quot;&quot; }</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="搭建后台"><a href="#搭建后台" class="header-anchor">#</a> 搭建后台</h2> <p>本次练习主要为了熟悉dva做状态管理，对后台要求不高，只是简单地返回商品数据</p> <ul><li><p><code>yarn add cors express</code></p></li> <li><p>新建<code>server</code>文件夹，用<code>express</code>搭建一个简单的后台</p> <ul><li>新建<code>data/products.json</code>，存放<code>json</code>格式的商品数据</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;products&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
      <span class="token string">&quot;bigImage&quot;</span><span class="token operator">:</span><span class="token string">&quot;http://localhost:3000/images/12064273040195392_1.jpg&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;smallImage&quot;</span><span class="token operator">:</span>     <span class="token string">&quot;http://localhost:3000/images/12064273040195392_2.jpg&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;sku&quot;</span><span class="token operator">:</span> <span class="token number">12064273040195392</span><span class="token punctuation">,</span>
      <span class="token string">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Cat Tee Black T-Shirt&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;4 MSL&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;availableSizes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;S&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;XS&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string">&quot;style&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Black with custom print&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;price&quot;</span><span class="token operator">:</span> <span class="token number">10.9</span><span class="token punctuation">,</span>
      <span class="token string">&quot;installments&quot;</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
      <span class="token string">&quot;currencyId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;USD&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;currencyFormat&quot;</span><span class="token operator">:</span> <span class="token string">&quot;$&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;isFreeShipping&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>  
</code></pre></div><ul><li>新建<code>app.js</code>，并编辑</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cors'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">3000</span><span class="token punctuation">;</span>
        
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/products'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token string">'products.json'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[products] API listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h2 id="前台开发"><a href="#前台开发" class="header-anchor">#</a> 前台开发</h2> <ul><li><p>本次练习使用<code>concurrently</code>并行命令</p> <ul><li><code>yarn add concurrently</code></li> <li>编辑<code>package.json</code><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;roadhog server&quot;</span><span class="token punctuation">,</span> 
    <span class="token string">&quot;server&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon server/app&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;roadhog build&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;lint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eslint --ext .js src test&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;precommit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;yarn run lint&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;concurrently \&quot;yarn run server\&quot; \&quot;yarn run start\&quot;&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div></li></ul> <p>到此，我们可以直接使用<code>yarn run dev</code>命令同时启动前后端,在<code>http://localhost:8000</code>访问</p></li> <li><p>创建商品列表路由</p> <ul><li><p>新建<code>src\routes\products\index.js</code>和<code>index.css</code> （dva默认支持CSS Module模块化， 如果需要使用<code>connect()</code>方法，需要从dva中引入）</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span>Component<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'dva'</span><span class="token punctuation">;</span>  <span class="token comment">// 引入connect()</span>
<span class="token comment">// import { Badge, Icon } from 'antd'  在组件中使用antd</span>
<span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">'./index.css'</span>  <span class="token comment">// 按需引入css</span>

<span class="token keyword">class</span> <span class="token class-name">Products</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>container<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        soooo many products!!!
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 这里的products是namespace为products的model层  </span>
<span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> products <span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    counts<span class="token operator">:</span> products<span class="token punctuation">.</span>counts
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 跟react-redux的connect使用方法相似</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>Products<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>编辑<code>src/router.js</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    <span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> Router<span class="token punctuation">,</span> Route<span class="token punctuation">,</span> Switch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'dva/router'</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> IndexPage <span class="token keyword">from</span> <span class="token string">'./routes/IndexPage'</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> Products <span class="token keyword">from</span> <span class="token string">'./routes/products'</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 使用hash前端路由模式</span>
    <span class="token keyword">function</span> <span class="token function">RouterConfig</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> history <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>Router history<span class="token operator">=</span><span class="token punctuation">{</span>history<span class="token punctuation">}</span><span class="token operator">&gt;</span>
    	  <span class="token operator">&lt;</span>Switch<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">&quot;/&quot;</span> exact component<span class="token operator">=</span><span class="token punctuation">{</span>IndexPage<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">&quot;/products&quot;</span> exact component<span class="token operator">=</span><span class="token punctuation">{</span>Products<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>Switch<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Router<span class="token operator">&gt;</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">export</span> <span class="token keyword">default</span> RouterConfig<span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li><p>dva已经在<code>src/utils/request.js</code>中为我们封装了fetch请求。所以我们可以新建<code>src/services/products.js</code>来封装一个向后台请求商品数据的方法</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">'../utils/request'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'/api/products'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>dva 通过 model 的概念把一个领域的模型管理起来，包含同步更新 state 的 reducers，处理异步逻辑的 effects，订阅数据源的 subscriptions</p> <p>新建<code>src/models/products.js</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> productsService <span class="token keyword">from</span> <span class="token string">'../services/products'</span><span class="token punctuation">;</span>
    
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    namespace<span class="token operator">:</span> <span class="token string">'products'</span><span class="token punctuation">,</span>
    state<span class="token operator">:</span> <span class="token punctuation">{</span>
        list<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">// 商品列表</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    reducers<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">save</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload<span class="token operator">:</span> <span class="token punctuation">{</span> data<span class="token operator">:</span> list <span class="token punctuation">}</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> list <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    effects<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token operator">*</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> call<span class="token punctuation">,</span> put <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>productsService<span class="token punctuation">.</span>fetch<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                type<span class="token operator">:</span> <span class="token string">'save'</span><span class="token punctuation">,</span>
                payload<span class="token operator">:</span> <span class="token punctuation">{</span> data<span class="token operator">:</span> data<span class="token punctuation">.</span>products <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    subscriptions<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> history <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> history<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> pathname <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>pathname <span class="token operator">===</span> <span class="token string">'/products'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'fetch'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>到此，model层和service层我们已经简单搭建好，可以在组件中拿到商品数据</p></li> <li><p>拓展：<code>model</code>中的<code>subscription</code>订阅</p> <ul><li><code>model</code>中的<code>subscription</code>相当于一个监听器，可以监听路由变化，鼠标，键盘变化，服务器连接变化，状态变化等，这样在其中就可以根据不同的变化做出相应的处理，在这个<code>subsription</code>中的方法名是随意定的，每次变化都会一次去调用里面的所有方法，所以一边会加相应的判断</li></ul></li> <li><p><code>dva-loading</code>插件<br>
在实际开发中，由于存在向后端请求商品数据，可能不能第一时间拿到商品数据，所以往往在数据加载的过程中，我们会给用户一个“正在加载中...”的提示。而<code>dva-loading</code>插件可以帮我们简化这一过程。</p> <ul><li><p><code>yarn add dva-loading</code></p></li> <li><p>修改<code>src/index.js</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> createLoading <span class="token keyword">from</span> <span class="token string">'dva-loading'</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">createLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>接着我们就可以在组件中使用</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">ProductsList</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> list<span class="token punctuation">,</span> loading <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token comment">// loading的值即为true,false</span>
    <span class="token comment">// 插件会自动设置数据里的 loading 状态为 true 或 false </span>
    <span class="token comment">// 我们可以通过loading的值判断是否正处于加载数据的状态，从而给用户一些提示</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> products<span class="token punctuation">,</span> loading <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  list<span class="token operator">:</span> products<span class="token punctuation">.</span>list<span class="token punctuation">,</span>
  <span class="token comment">// 注意：products为所需要的model层的namespace</span>
  loading<span class="token operator">:</span> loading<span class="token punctuation">.</span>models<span class="token punctuation">.</span>products
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>ProductsList<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/frontend/webpack-react.html" class="prev">
        使用webpack搭建React项目开发环境
      </a></span> <span class="next"><a href="/frontend/source-code.html">
        试着实现JS源码
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2619889f.js" defer></script><script src="/assets/js/2.96a76ef5.js" defer></script><script src="/assets/js/8.a0ec3913.js" defer></script>
  </body>
</html>
