<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>用Vue+Node搭建网上购物商城——记录篇 | QuiErro&#39;s blog</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.3.0">
    
    
    <link rel="preload" href="/assets/css/0.styles.93dcc6b2.css" as="style"><link rel="preload" href="/assets/js/app.2619889f.js" as="script"><link rel="preload" href="/assets/js/2.96a76ef5.js" as="script"><link rel="preload" href="/assets/js/15.8ff5a488.js" as="script"><link rel="prefetch" href="/assets/js/10.5bda610d.js"><link rel="prefetch" href="/assets/js/11.aaafe754.js"><link rel="prefetch" href="/assets/js/12.c8c4a9dc.js"><link rel="prefetch" href="/assets/js/13.bb83ed70.js"><link rel="prefetch" href="/assets/js/14.7d6fc175.js"><link rel="prefetch" href="/assets/js/16.f4417e8a.js"><link rel="prefetch" href="/assets/js/17.23a97fb3.js"><link rel="prefetch" href="/assets/js/18.8a0fa7a6.js"><link rel="prefetch" href="/assets/js/19.1ae67b9a.js"><link rel="prefetch" href="/assets/js/3.def7da81.js"><link rel="prefetch" href="/assets/js/4.ad57049c.js"><link rel="prefetch" href="/assets/js/5.50374dc2.js"><link rel="prefetch" href="/assets/js/6.be928897.js"><link rel="prefetch" href="/assets/js/7.eb8c7482.js"><link rel="prefetch" href="/assets/js/8.a0ec3913.js"><link rel="prefetch" href="/assets/js/9.ffa921f0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.93dcc6b2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">QuiErro's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/frontend/summary-antdpro.html" class="nav-link">
  Frontend
</a></div><div class="nav-item"><a href="/frontend/frontend-algorithm.html" class="nav-link">
  前端算法
</a></div><div class="nav-item"><a href="/laravel/laradock.html" class="nav-link">
  Laravel
</a></div> <a href="https://github.com/QuiErro/QuiErro.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    My GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/frontend/summary-antdpro.html" class="nav-link">
  Frontend
</a></div><div class="nav-item"><a href="/frontend/frontend-algorithm.html" class="nav-link">
  前端算法
</a></div><div class="nav-item"><a href="/laravel/laradock.html" class="nav-link">
  Laravel
</a></div> <a href="https://github.com/QuiErro/QuiErro.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    My GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend/summary-antdpro.html" class="sidebar-link">antd pro 使用小结</a></li><li><a href="/frontend/antdpro-authority-management.html" class="sidebar-link">antd pro 权限管理</a></li><li><a href="/frontend/frontend-algorithm.html" class="sidebar-link">前端算法</a></li><li><a href="/frontend/webpack-setting.html" class="sidebar-link">Webpack基本配置</a></li><li><a href="/frontend/learning-nuxt.html" class="sidebar-link">Nuxt.js学习笔记</a></li><li><a href="/frontend/learning-next.html" class="sidebar-link">Next.js学习笔记</a></li><li><a href="/frontend/webpack-react.html" class="sidebar-link">使用webpack搭建React项目开发环境</a></li><li><a href="/frontend/dva-shopping-cart.html" class="sidebar-link">初探dva——购物车实战</a></li><li><a href="/frontend/source-code.html" class="sidebar-link">试着实现JS源码</a></li><li><a href="/frontend/prototype.html" class="sidebar-link">谈谈JS中的继承与原型链</a></li><li><a href="/frontend/colorful-balls.html" class="sidebar-link">炫彩小球：基于Canvas和ES6中的Class类知识点的练习</a></li><li><a href="/frontend/web-shop.html" class="active sidebar-link">用Vue+Node搭建网上购物商城</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/web-shop.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/frontend/web-shop.html#一、功能" class="sidebar-link">一、功能</a></li><li class="sidebar-sub-header"><a href="/frontend/web-shop.html#二、项目效果预览" class="sidebar-link">二、项目效果预览</a></li><li class="sidebar-sub-header"><a href="/frontend/web-shop.html#三、运行" class="sidebar-link">三、运行</a></li><li class="sidebar-sub-header"><a href="/frontend/web-shop.html#四、目录结构" class="sidebar-link">四、目录结构</a></li><li class="sidebar-sub-header"><a href="/frontend/web-shop.html#四、开发中的一些细节" class="sidebar-link">四、开发中的一些细节</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="用vue-node搭建网上购物商城——记录篇"><a href="#用vue-node搭建网上购物商城——记录篇" class="header-anchor">#</a> 用Vue+Node搭建网上购物商城——记录篇</h1> <ul><li><a href="https://github.com/QuiErro/WebShop" target="_blank" rel="noopener noreferrer">github地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>项目采用的技术栈:  Vue+Node+MySQL<br>
前端：用Vue-cli搭建，使用Vue全家桶+element-ui<br>
后端：express框架<br>
数据库：MySQL</p> <p>其实项目初版本早就写完了，但感觉完成度不高，所以现在想完善这个项目，熟练下vue和node的开发运用，然后也记录一下我的开发过程</p> <h2 id="一、功能"><a href="#一、功能" class="header-anchor">#</a> 一、功能</h2> <h3 id="普通用户"><a href="#普通用户" class="header-anchor">#</a> 普通用户</h3> <ul><li>注册、登录（图形验证码）</li> <li>定位 （腾讯地图定位功能）、自主选择所在城市</li> <li>商品
<ul><li>分类</li> <li>简单展示商品</li> <li>查看商品详情</li> <li>商品评论</li></ul></li> <li>分页功能</li> <li>购物车功能
<ul><li>加入购物车</li> <li>购物车商品数量增减</li> <li>清空购物车</li> <li>商品结算</li></ul></li> <li>多关键词模糊搜索商品 （关键词需为商品名称）</li> <li>用户个人中心
<ul><li>修改用户信息 （头像、昵称、简介...）</li> <li>修改手机号</li> <li>修改密码</li></ul></li></ul> <h3 id="管理员"><a href="#管理员" class="header-anchor">#</a> 管理员</h3> <ul><li>登录（固定账号密码）</li> <li>查看数据库商品信息</li> <li>商品上架（添加商品）</li> <li>删除/修改商品</li> <li>分页功能</li></ul> <h2 id="二、项目效果预览"><a href="#二、项目效果预览" class="header-anchor">#</a> 二、项目效果预览</h2> <h3 id="商城前台部分"><a href="#商城前台部分" class="header-anchor">#</a> 商城前台部分</h3> <h4 id="首页"><a href="#首页" class="header-anchor">#</a> 首页</h4> <p><img src="https://user-gold-cdn.xitu.io/2019/11/14/16e67b9c7f247770?w=1346&amp;h=657&amp;f=gif&amp;s=2254412" alt=""></p> <h4 id="选择所在城市"><a href="#选择所在城市" class="header-anchor">#</a> 选择所在城市</h4> <p><img src="https://user-gold-cdn.xitu.io/2019/11/13/16e622c33b96fa8e?w=811&amp;h=244&amp;f=png&amp;s=28969" alt=""></p> <h4 id="首页右侧的购物车提示区"><a href="#首页右侧的购物车提示区" class="header-anchor">#</a> 首页右侧的购物车提示区</h4> <p><img src="https://user-gold-cdn.xitu.io/2019/11/10/16e53ead73253d67?w=1363&amp;h=646&amp;f=png&amp;s=459044" alt=""></p> <h4 id="分类展示页面"><a href="#分类展示页面" class="header-anchor">#</a> 分类展示页面</h4> <p><img src="https://user-gold-cdn.xitu.io/2019/11/10/16e5338f6c827851?w=1351&amp;h=648&amp;f=png&amp;s=152959" alt="分类展示页"></p> <h4 id="购物车"><a href="#购物车" class="header-anchor">#</a> 购物车</h4> <p><img src="https://user-gold-cdn.xitu.io/2019/11/10/16e53ec12409f1de?w=1350&amp;h=647&amp;f=png&amp;s=89950" alt=""></p> <h4 id="商品详情页"><a href="#商品详情页" class="header-anchor">#</a> 商品详情页</h4> <p><img src="https://user-gold-cdn.xitu.io/2019/11/10/16e533e7cf6ee401?w=1345&amp;h=991&amp;f=png&amp;s=148317" alt="商品详情页"></p> <h4 id="登录-注册"><a href="#登录-注册" class="header-anchor">#</a> 登录/注册</h4> <p><img src="https://user-gold-cdn.xitu.io/2019/11/10/16e534bef65cfb02?w=576&amp;h=622&amp;f=png&amp;s=18566" alt="登录/注册"> <img src="https://user-gold-cdn.xitu.io/2019/11/10/16e534d2726bbf5f?w=379&amp;h=371&amp;f=png&amp;s=8744" alt="登录/注册"></p> <h3 id="用户中心"><a href="#用户中心" class="header-anchor">#</a> 用户中心</h3> <p><img src="https://user-gold-cdn.xitu.io/2019/11/13/16e622dfb01fb587?w=1349&amp;h=598&amp;f=png&amp;s=41177" alt=""></p> <h3 id="商城后台部分"><a href="#商城后台部分" class="header-anchor">#</a> 商城后台部分</h3> <h5 id="商品信息页"><a href="#商品信息页" class="header-anchor">#</a> 商品信息页</h5> <p><img src="https://user-gold-cdn.xitu.io/2019/11/10/16e53444b936925a?w=1345&amp;h=849&amp;f=png&amp;s=89796" alt="商品信息页"></p> <h4 id="添加商品"><a href="#添加商品" class="header-anchor">#</a> 添加商品</h4> <p><img src="https://user-gold-cdn.xitu.io/2019/11/10/16e5345a6a8f3321?w=1345&amp;h=863&amp;f=png&amp;s=54525" alt="添加商品"></p> <h2 id="三、运行"><a href="#三、运行" class="header-anchor">#</a> 三、运行</h2> <p>项目后端服务器是基于node、MySQL开发，运行前请确认系统已安装相关应用</p> <ul><li><a href="https://github.com/QuiErro/WebShop" target="_blank" rel="noopener noreferrer">github地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><code>git clone</code></li></ul> <h3 id="服务器端"><a href="#服务器端" class="header-anchor">#</a> 服务器端</h3> <ul><li><code>cd web-server</code></li> <li>将web-server文件夹下的<code>shop.sql</code>导入MySQL数据库中</li> <li><code>npm install</code> 安装依赖</li> <li>修改<code>web-server/src/config.js</code>文件，此文件记录项目的全局变量，在文件中找到<code>password、database、user</code>属性，根据你的数据库信息修改它们的值</li> <li><code>npm run dev</code> 在本地运行，启动服务器</li></ul> <h3 id="客户端"><a href="#客户端" class="header-anchor">#</a> 客户端</h3> <ul><li><code>cd web-client</code></li> <li><code>npm install</code>  安装依赖</li> <li><code>npm run dev</code> 在本地运行</li> <li>接着就可以在<code>http://localhost:8080</code>下访问到该项目</li></ul> <h2 id="四、目录结构"><a href="#四、目录结构" class="header-anchor">#</a> 四、目录结构</h2> <div class="language-html extra-class"><pre class="language-html"><code>web-client 前端部分：
├── build                      // 构建相关  
├── config                     // 配置相关
├── src                        // 源代码
│   ├── api                    
│   |   ├── ajax.js            // 使用axios，封装ajax
│   |   ├── index.js           // 后端接口，封装请求接口
│   ├── common                 // 字体、图片等静态资源
│   ├── components             // 全局公用组件
│   ├── config                 // 全局配置
│   |   ├── filters.js         // 全局过滤器
│   |   ├── utils.js           // 全局方法
│   |   ├── area.js            // 全国城市区域，配合element-ui级联选择器
│   ├── pages                  // 项目视图页面
│   ├── router                 // 路由配置
│   ├── store                  // Vuex数据存储器
│   ├── App.vue                // 入口页面
│   ├── main.js                // 入口文件
├── static                     // 静态资源
├── .babelrc                   // babel-loader 配置
├── .gitignore                 // git 忽略
├── index.html                 // 项目html
└── package.json               // 包依赖配置

web-server 后端部分：
├── db                         // MySQL数据连接  
├── public                     // 静态资源
├── routes                     // 后端路由,项目接口
├── static                     // 静态资源
├── src                        // 源代码
│   ├── app.js                 // 项目入口文件，配置，初始化
│   ├── config.js              // 全局公用参数记录
├── utils                      // 全局公用方法
├── views                      // 视图页面
├── .babelrc                   // babel-loader 配置
├── main.js                    // 入口文件
├── package.json               // 包依赖配置
├── README.md                  // 项目说明文件
└── shop.sql                   // 注入MySQL的sql语句
</code></pre></div><h2 id="四、开发中的一些细节"><a href="#四、开发中的一些细节" class="header-anchor">#</a> 四、开发中的一些细节</h2> <h3 id="_1-跨域问题"><a href="#_1-跨域问题" class="header-anchor">#</a> 1. 跨域问题</h3> <ul><li>后端部分使用<code>cors</code>来解决跨域<div class="language-javascript extra-class"><pre class="language-javascript"><code>cd web<span class="token operator">-</span>server
npm i <span class="token operator">-</span><span class="token constant">S</span> cors
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 在 web-server/src/app.js 中引入</span>
<span class="token keyword">import</span> cors <span class="token keyword">from</span> <span class="token string">'cors'</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>前端部分进行跨域配置<div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 在 web-client/config/index.js 中进行配置</span>
proxyTable<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'/api'</span><span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token comment">//使'api'代替服务器地址</span>
       target<span class="token operator">:</span> <span class="token string">'http://localhost:3000/'</span><span class="token punctuation">,</span> <span class="token comment">//源地址</span>
       changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//改变源</span>
       pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'^/api'</span><span class="token operator">:</span> <span class="token string">''</span> <span class="token comment">//路径重写</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div></li></ul> <h3 id="_2-登录的图形验证码"><a href="#_2-登录的图形验证码" class="header-anchor">#</a> 2. 登录的图形验证码</h3> <ul><li>项目中用的是node中的<code>svg-captcha</code>模块</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> svgCaptcha <span class="token keyword">from</span> <span class="token string">'svg-captcha'</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/captcha'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 生成随机验证码</span>
    <span class="token keyword">let</span> captcha <span class="token operator">=</span> svgCaptcha<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        color<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        noise<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        ignoreChars<span class="token operator">:</span> <span class="token string">'0o1iIO'</span><span class="token punctuation">,</span>
        size<span class="token operator">:</span> <span class="token number">4</span> 
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 保存到session</span>
    req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>captcha <span class="token operator">=</span> captcha<span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toLocaleLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 验证码的文本</span>

    <span class="token comment">// 返回客户端，客户端接收到的是svg格式</span>
    res<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'svg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>captcha<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>除获取后端生成的图形验证码，前端部分还需实现点击验证码，能刷新验证码功能：</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>img 
  ref<span class="token operator">=</span><span class="token string">&quot;captcha&quot;</span> 
  src<span class="token operator">=</span><span class="token string">&quot;http://localhost:3000/api/captcha&quot;</span> 
  @click<span class="token punctuation">.</span>prevent<span class="token operator">=</span><span class="token string">&quot;getCaptcha()&quot;</span>
<span class="token operator">&gt;</span>

<span class="token comment">// 获取图形验证码</span>
<span class="token function">getCaptcha</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 通过在url后面添加查询字符串 ?time=' + new Date(),</span>
  <span class="token comment">// 这样当用户每次点击验证码时，src的地址都不一样，浏览器将重新发起请求，而不是简单的304缓存</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>captcha<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'http://localhost:3000/api/captcha?time='</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-session失效"><a href="#_3-session失效" class="header-anchor">#</a> 3. session失效</h3> <p>项目中用的是<code>express-session</code>来记录session，主要是记录已登录的用户id和当前前端页面获取的图形验证码文本。最开始，前端部分跨域配置中源地址写的是：<code>http://127.0.0.1:3000/</code>，且获取图形验证码中也使用的<code>&lt;img src:&quot;http://127.0.0.1:3000/api/captcha&quot;&gt;</code>，但后端中就是获取不到session值。
后来看到别人的项目总结里面也发现类似问题，提到说：后端验证时，<code>http://localhost:3000</code>和<code>http://127.0.0.1:3000</code>代表的不是同一个客户端，所以访问不到session
于是尝试把前端部分关于后端接口的地址全都改为<code>http://localhost:3000/xxx</code>形式，验证后，还真成功了</p> <h3 id="_4-按需加载组件（优化首屏加载速度）"><a href="#_4-按需加载组件（优化首屏加载速度）" class="header-anchor">#</a> 4. 按需加载组件（优化首屏加载速度）</h3> <ul><li>路由懒加载<div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// web-client/src/router/index.js 示例</span>
<span class="token keyword">const</span> <span class="token function-variable function">Home</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./../pages/Home/Home'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

routes<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'/home'</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> Home
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div></li></ul> <h3 id="_5-前台页面顶部搜索区的显示和隐藏"><a href="#_5-前台页面顶部搜索区的显示和隐藏" class="header-anchor">#</a> 5. 前台页面顶部搜索区的显示和隐藏</h3> <ul><li>通常在购物商城中，会发现页面顶部会实现搜索框，考虑到它在多个页面都会出现，于是封装成全局组件，即 <code>src\components\HeaderSearch\HeaderSearch.vue</code>  并在<code>App.vue</code>中引入<br> <img src="https://user-gold-cdn.xitu.io/2019/11/10/16e53c57b398f8a4?w=718&amp;h=99&amp;f=png&amp;s=2913" alt=""></li> <li>然后问题出现了，有些页面其实并不需要出现搜索框，比如商品详情页、登录/注册..于是决定在<code>router</code>内动态设置<code>meta</code>，来控制全局组件的显示和隐藏<div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 在 router\index.js 中设置mate  示例</span>
routes<span class="token operator">:</span> <span class="token punctuation">[</span>
	<span class="token punctuation">{</span>
	  path<span class="token operator">:</span> <span class="token string">'/home'</span><span class="token punctuation">,</span>
	  component<span class="token operator">:</span> Home<span class="token punctuation">,</span>
	  <span class="token comment">// true 代表该路由页面显示相关的全局组件</span>
	  meta<span class="token operator">:</span> <span class="token punctuation">{</span>showHeaderTop<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> showHeaderSearch<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 在 App.vue 中根据 mate 控制组件显示与隐藏</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>HeaderTop v<span class="token operator">-</span>show<span class="token operator">=</span><span class="token string">&quot;$route.meta.showHeaderTop&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>  
        <span class="token operator">&lt;</span>HeaderSearch v<span class="token operator">-</span>show<span class="token operator">=</span><span class="token string">&quot;$route.meta.showHeaderSearch&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    	<span class="token operator">&lt;</span>keep<span class="token operator">-</span>alive<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>router<span class="token operator">-</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>router<span class="token operator">-</span>view<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>keep<span class="token operator">-</span>alive<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre></div></li></ul> <h3 id="_6-三级表达式"><a href="#_6-三级表达式" class="header-anchor">#</a> 6. 三级表达式</h3> <p>在Vue中，我们通常使用插值表达式来页面取值，但是遇到需要异步请求获取数据后，再渲染到页面上时，实际上，页面渲染时会先显示数据的初始值，请求得到数据后，才会正常显示。所以有些三级表达式刚开始加载，得不到数据会报错。此时，可以结合<code>v-if</code>解决，在明确得到数据后，再渲染元素</p> <h3 id="_7-封装node与mysql连接"><a href="#_7-封装node与mysql连接" class="header-anchor">#</a> 7. 封装Node与MySQL连接</h3> <ul><li>可以新建一个<code>db\db.js</code>文件,里面放数据库连接的代码，最后用<code>export default conn;</code>输出<code>conn</code>，这样在项目中操作数据库时，只需要连接一次即可，提升效率<div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> mysql <span class="token keyword">from</span> <span class="token string">'mysql'</span>
<span class="token keyword">import</span> config <span class="token keyword">from</span> <span class="token string">'../src/config'</span>

<span class="token keyword">const</span>  conn <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    host<span class="token operator">:</span> config<span class="token punctuation">.</span>host<span class="token punctuation">,</span> <span class="token comment">// 数据库的地址</span>
    user<span class="token operator">:</span> config<span class="token punctuation">.</span>user<span class="token punctuation">,</span> <span class="token comment">// 账号</span>
    password<span class="token operator">:</span> config<span class="token punctuation">.</span>password<span class="token punctuation">,</span> <span class="token comment">// 密码</span>
    database<span class="token operator">:</span> config<span class="token punctuation">.</span>database<span class="token punctuation">,</span> <span class="token comment">// 数据库名称</span>
    multipleStatements<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 允许多条sql同时查询</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

conn<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> conn<span class="token punctuation">;</span>
</code></pre></div></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/frontend/colorful-balls.html" class="prev">
        炫彩小球：基于Canvas和ES6中的Class类知识点的练习
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2619889f.js" defer></script><script src="/assets/js/2.96a76ef5.js" defer></script><script src="/assets/js/15.8ff5a488.js" defer></script>
  </body>
</html>
