(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{218:function(a,s,t){"use strict";t.r(s);var r=t(0),e=Object(r.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"使用laradock搭建laravel项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用laradock搭建laravel项目"}},[a._v("#")]),a._v(" 使用laradock搭建laravel项目")]),a._v(" "),t("h2",{attrs:{id:"准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备"}},[a._v("#")]),a._v(" 准备")]),a._v(" "),t("ul",[t("li",[a._v("Git")]),a._v(" "),t("li",[a._v("Docker "),t("code",[a._v(">= 1.12")])])]),a._v(" "),t("h2",{attrs:{id:"安装和配置laradock"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装和配置laradock"}},[a._v("#")]),a._v(" 安装和配置laradock")]),a._v(" "),t("ul",[t("li",[a._v("启动docker，新建项目目录")])]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[a._v("$ mkdir laravel "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" cd laravel\n")])])]),t("ul",[t("li",[a._v("安装laradock")])]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[a._v("$ git clone https"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("github"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("Laradock"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("laradock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("git\n")])])]),t("ul",[t("li",[a._v("进入laradock目录，并将env-example重命名为.env")])]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[a._v("$ cd laradock\n$ cp env"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("example "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("env\n")])])]),t("ul",[t("li",[a._v("修改"),t("code",[a._v(".env")]),a._v("默认配置")])]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[a._v("# 本地存放项目代码的目录，默认和laradock同级目录\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("APP_CODE_PATH_HOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("\n\n# 容器中存放项目的目录，是laradock和项目代码的父级目录\n# 会和本地目录建立软链接\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("APP_CODE_PATH_CONTAINER")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("var")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("www\n\n# 视情况而定，可将mysql版本从最新版改为"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5.7")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("MYSQL_VERSION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("latest\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("MYSQL_VERSION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5.7")]),a._v("\n\n# 存放数据的目录（若将mysql版本改为"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5.7")]),a._v("，就要修改，否则报错）\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DATA_PATH_HOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("~")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("laradock"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("data\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DATA_PATH_HOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("data\n")])])]),t("ul",[t("li",[a._v("构建容器")])]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[a._v("$ docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("compose up "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("d nginx mysql redis\n")])])]),t("p",[a._v("有需求其他应用，可以如上述命令构建容器。另外laradock会自动构建"),t("code",[a._v("php-fpm")]),a._v("和"),t("code",[a._v("workspace")]),a._v("这两个容器")]),a._v(" "),t("h2",{attrs:{id:"创建laravel项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建laravel项目"}},[a._v("#")]),a._v(" 创建laravel项目")]),a._v(" "),t("ul",[t("li",[a._v("在"),t("code",[a._v("laradock")]),a._v("同级目录下创建新laravel项目")])]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[a._v("$ cd "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("\n$ composer create"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("project "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("prefer"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("dist laravel"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("laravel myproject\n")])])]),t("p",[a._v("创建成功后的目录结构：")]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v(" laravel\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" laradock\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" myproject\n")])])]),t("ul",[t("li",[a._v("配置nginx\n进入laradock/nginx/sites目录，复制"),t("code",[a._v("laravel.conf")]),a._v("并作配置")])]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[a._v("$ cd laradock"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("nginx"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("sites\n$ cp laravel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("conf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("example laravel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("conf\n")])])]),t("p",[a._v("根据需求修改域名和路径")]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[a._v("server_name myproject"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n# 要与"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("env中的"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("APP_CODE_PATH_CONTAINER")]),a._v("相同\nroot "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("var")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("www"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("myproject"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" \n")])])]),t("p",[a._v("修改完后重启nginx")]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[a._v("$ docker restart laradock_nginx_1\n")])])]),t("p",[a._v("修改本地域名解析文件，"),t("code",[a._v("windows")]),a._v("下进入"),t("code",[a._v("C:\\Windows\\System32\\drivers\\etc")]),a._v("目录编辑"),t("code",[a._v("hosts")]),a._v("文件，最下方新增")]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v(".0")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v(".1")]),a._v(" myproject"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("test\n")])])]),t("p",[a._v("完成域名映射后打开 http://myproject.test 即可访问")]),a._v(" "),t("ul",[t("li",[a._v("修改项目配置")])]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[a._v("$ cd "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("\n$ cd myproject\n")])])]),t("p",[a._v("根据laradock下的"),t("code",[a._v(".env")]),a._v("修改项目目录下的"),t("code",[a._v(".env")])]),a._v(" "),t("ul",[t("li",[a._v("修改"),t("code",[a._v("redis")]),a._v("配置")])]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("REDIS_CLIENT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("predis\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("REDIS_HOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("redis      # 必须填redis\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("REDIS_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("REDIS_PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("6379")]),a._v("\n")])])]),t("ul",[t("li",[a._v("修改"),t("code",[a._v("mysql")]),a._v("配置")])]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DB_CONNECTION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("mysql\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DB_HOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("mysql        # 必须填mysql\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DB_PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3306")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DB_DATABASE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("default")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DB_USERNAME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("default")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DB_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("secret\n")])])]),t("p",[a._v("除了"),t("code",[a._v("DB_HOST")]),a._v("必填"),t("code",[a._v("mysql")]),a._v("，其他可根据laradock下的.env自行调整，但必须保持两个文件配置参数相同"),t("br"),a._v("\n若修改了laradock下的"),t("code",[a._v(".env")]),a._v("文件：")]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[a._v("#停止mysql容器\n$ docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("compose stop mysql\n\n# 重启docker，并构建mysql\n$ docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("compose build mysql\n\n# 重新创建容器\n$ docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("compose up "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("d mysql\n")])])]),t("p",[a._v("查看mysql容器内的版本，会发现配置已经发生改变。之后根据配置修改项目目录下的"),t("code",[a._v(".env")])]),a._v(" "),t("p",[a._v("这里曾遇到过一个问题，在修改完两方"),t("code",[a._v(".env")]),a._v("文件后，即便两个文件关于数据库的配置相同，但是进入到工作区后，在项目目录下执行"),t("code",[a._v("php artisan migrate")]),a._v("会报错")]),a._v(" "),t("ul",[t("li",[a._v("进入工作区")])]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[a._v("$ docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("compose exec "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("user"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("laradock workspace bash\n")])])]),t("ul",[t("li",[a._v("进入项目目录并执行 "),t("code",[a._v("php artisan migrate")])])]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("var")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("www# cd myproject\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("var")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("www"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("myproject# php artisan migrate   # 报错\n")])])]),t("p",[a._v("解决方法：laravel项目修改配置后先清理缓存，再执行")]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("var")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("www"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("myproject# php artisan config"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("clear\n")])])]),t("ul",[t("li",[a._v("使用数据库管理工具（mysql）\n新建连接，修改连接属性")])]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[a._v("主机名或"),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("IP")]),a._v("地址： localhost\n端口：          "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3306")]),a._v("  \n用户名：\t        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("default")]),a._v("\n密码：\t\tsecret\n")])])]),t("p",[a._v("主机名或IP地址填localhost，3306端口转发，第一次连接时可以成功访问数据库，但二次连接时将会报错"),t("code",[a._v("1251")]),a._v("（待解决）")])])}),[],!1,null,null,null);s.default=e.exports}}]);